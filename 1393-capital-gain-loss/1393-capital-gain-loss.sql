SELECT S.STOCK_NAME,
    SUM(
        CASE WHEN S.OPERATION = 'Buy' THEN -S.PRICE
        ELSE S.PRICE
        END
    ) CAPITAL_GAIN_LOSS
FROM STOCKS S
GROUP BY S.STOCK_NAME;